var game,DiamondScope=function(){var e=function(e,n,t,i,r){this.question=e,this.answers=n,this.rightAnswer=t,this.difficulty=i,this.id=r};e.prototype={getRightAnswer:function(){return this.rightAnswer}};var n=function(e,n){this.id=e,this.name=n,this.questionCount=0,this.joker={fifty:1,audience:1}};n.prototype={useJoker:function(e){return 1==e?0!=this.joker.fifty?(this.joker.fifty=0,game.useFiftyFifty(r.rightAnswer)):[]:2==e&&0!=this.joker.audience?(this.joker.audience=0,game.useAudience(r.difficulty,r.rightAnswer)):void 0}};var t=function(e){this.round=0,this.players=[],this.ranking={rounds:void 0,points:void 0},this.questions=e};t.prototype={addPlayer:function(e){id=this.players.length,this.players.push(new n(id,e))},useFiftyFifty:function(e){var n=[!1,!1,!1,!1];n[e]=!0;for(var t=parseInt(4*Math.random());t==e;)t=parseInt(4*Math.random());return n[t]=!0,n},useAudience:function(e,n){var t;switch(e){case 0:t=0;break;case 1:t=5;break;case 2:t=9;break;case 3:t=13;break;case 4:t=17;break;default:t=0}var i=[];i[0]=parseInt(20*Math.random())+40-t,i[1]=parseInt((100-i[0])/3*(Math.random()+.4)),i[2]=parseInt((100-i[0])/3*(Math.random()+.4)),i[3]=100-i[0]-i[1]-i[2];var r=i[n];return i[n]=i[0],i[0]=r,i}};var r,i=[],a=function(){u(),o(),$.getJSON(SERVER_URL+QUESTION_FILE,function(n){i=n,i.forEach(function(n,t){i[t]=new e(n.question,n.answers,n.rightAnswer,n.difficulty,n.id)}),c()})},o=function(){$(window).resize(function(){u()}),$(document).on("click","#joker-fifty",function(){answers=game.useFiftyFifty(r.rightAnswer),answers.forEach(function(e,n){e||(char=0==n?"a":1==n?"b":2==n?"c":"d",$("#answer-"+char).html(""))})}),$(document).on("click","#joker-audience",function(){answers=game.useAudience(f(game.round),r.rightAnswer),answers.forEach(function(e,n){char=0==n?"a":1==n?"b":2==n?"c":"d",$("#answer-"+char).html(answers[n]+"%")})}),$(document).on("click",".answer",function(){id=$(this).data("id"),difficulty=f(game.round++),id==r.rightAnswer?($(this).addClass("green"),setTimeout(function(){h(difficulty)},1500)):($(this).addClass("red"),$(".answer").each(function(){$(this).data("id")==r.rightAnswer&&$(this).addClass("yellow")}),setTimeout(function(){h(difficulty)},1500))})},u=function(){$(window).outerHeight()/9>$(window).outerWidth()/16?($("body > #video-background").css({width:"auto",height:"100%"}),$("#video-background-inner").css({width:"auto",height:"150%"})):($("body > #video-background").css({width:"100%",height:"auto"}),$("#video-background-inner").css({width:"150%",height:"auto"}))},c=function(){game=new t(i),h(0)},d=function(e){return selectedQuestions=$.grep(game.questions,function(n){return n.difficulty==e}),r=selectedQuestions[Math.floor(Math.random()*selectedQuestions.length)],r.difficulty=-1,r},f=function(e){return Math.floor(e/3)},h=function(e){var t,i,r,n=d(e),s=0;for(i=0;4>i;i++)t=Math.floor(Math.random()*(i+1)),t==s&&(n.rightAnswer=i,s=i),r=n.answers[i],n.answers[i]=n.answers[t],n.answers[t]=r;var a=" (Kategorie: "+(e+1)+")";$("#current-question > h3").html("Frage "+n.id+a),$("#question").html(n.question),$("#answer-a").html(n.answers[0]),$("#answer-b").html(n.answers[1]),$("#answer-c").html(n.answers[2]),$("#answer-d").html(n.answers[3]),$(".answer").removeClass("red"),$(".answer").removeClass("green"),$(".answer").removeClass("yellow")};return{init:a}}();$(function(){DiamondScope.init()});