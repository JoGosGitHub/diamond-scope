var game,DiamondScope=function(){var n=function(e,n,i,t,a){this.question=e,this.answers=n,this.rightAnswer=i,this.difficulty=t,this.id=a,this.used=!1};n.prototype={getRightAnswer:function(){return this.rightAnswer}};var t=function(e,n){this.id=e,this.name=n,this.questionCount=0,this.joker={fifty:1,audience:1}};t.prototype={useJoker:function(e){return 0==e?0!=this.joker.fifty?(this.joker.fifty=0,game.useFiftyFifty(d.rightAnswer)):[]:1==e?0!=this.joker.audience?(this.joker.audience=0,game.useAudience(d.difficulty,d.rightAnswer)):[]:void 0}};var a=function(e){this.round=0,this.players=[],this.gameMode=void 0,this.ranking={rounds:{},points:{}},this.questions=e,this.questions.forEach(function(e){e.used=!1}),this.questionID=0,this.currentPlayer=0,this.expulsedPlayers=void 0};a.prototype={addPlayer:function(e){id=this.players.length,this.players.push(new t(id,e))},useFiftyFifty:function(e){var n=[!1,!1,!1,!1];n[e]=!0;for(var i=parseInt(4*Math.random());i==e;)i=parseInt(4*Math.random());return n[i]=!0,n},useAudience:function(e,n){var i;switch(e){case 0:i=0;break;case 1:i=5;break;case 2:i=9;break;case 3:i=13;break;case 4:i=17;break;default:i=0}var t=[];t[0]=parseInt(20*Math.random())+40-i,t[1]=parseInt((100-t[0])/3*(Math.random()+.4)),t[2]=parseInt((100-t[0])/3*(Math.random()+.4)),t[3]=100-t[0]-t[1]-t[2];var a=t[n];return t[n]=t[0],t[0]=a,t},nextPlayer:function(){for(this.currentPlayer++,this.currentPlayer==this.players.length&&(this.currentPlayer=0);this.expulsedPlayers[this.currentPlayer];)this.currentPlayer++,this.currentPlayer==this.players.length&&(this.currentPlayer=0)},conclude:function(){return obj=this,1==obj.gameMode?(obj.players.sort(function(e,n){return n.questionCount-e.questionCount}),void 0===obj.ranking.rounds[obj.players[0].id]&&(game.ranking.rounds[game.players[0].id]=0),obj.ranking.rounds[obj.players[0].id]++,content="<h1>Herzlichen Glückwunsch "+obj.players[0].name+"</h1>",obj.players.forEach(function(e,n){e.questionCount--,void 0===obj.ranking.points[e.id]&&(obj.ranking.points[e.id]=0),obj.ranking.points[e.id]+=e.questionCount,content+="<h1>"+(n+1)+". "+e.name+" mit "+e.questionCount+" Punkten</h1>",e.questionCount=0,e.joker.audience=1,e.joker.fifty=1})):0==obj.gameMode&&(player=obj.players[0],player.questionCount--,content="<h1>Du hast "+player.questionCount+" von "+QUESTIONS_PER_ROUND+" Fragen richtig beantwortet!</h1>",void 0===obj.ranking.points[0]&&(obj.ranking.points[0]=0),obj.ranking.points[0]+=player.questionCount,player.questionCount=0,player.joker.audience=1,player.joker.fifty=1),content},end:function(){return content="",this.round++,0==game.gameMode?content+="<h1>Du hast "+this.round+" Runden gespielt und dabei "+obj.ranking.points[0]+" Punkte erreicht</h1>":1==game.gameMode&&(obj=this,game.players.sort(function(e,n){obj.ranking.points[n.id]-obj.ranking.points[e.id]}),game.players.forEach(function(e,n){void 0===obj.ranking.rounds[e.id]&&(obj.ranking.rounds[e.id]=0),content+="<h1>"+(n+1)+". "+e.name+" mit "+obj.ranking.points[e.id]+" Punkten und "+obj.ranking.rounds[e.id]+" gewonnenen Runden</h1>"})),content}};var d,s=[],r=function(){l(),o(),$.getJSON(SERVER_URL+QUESTION_FILE,function(e){s=e,s.forEach(function(e,i){s[i]=new n(e.question,e.answers,e.rightAnswer,e.difficulty,e.id)}),c()})},o=function(){$(window).resize(function(){l()}),$(window).load(function(){l()}),$(document).on("click","#joker-fifty",function(){$(this).addClass("disabled"),answers=game.players[game.currentPlayer].useJoker(0),answers.forEach(function(e,n){e||(char=0==n?"a":1==n?"b":2==n?"c":"d",$("#answer-"+char).html(""),$("#answer-"+char).parent().addClass("disabled"))})}),$(document).on("click","#joker-audience",function(){$(this).addClass("disabled"),answers=game.players[game.currentPlayer].useJoker(1),answers.forEach(function(e,n){char=0==n?"a":1==n?"b":2==n?"c":"d",$("#answer-"+char).html(answers[n]+"%")})}),$(document).on("click",".answer",function(){$(this).hasClass("disabled")||($(".answer").addClass("disabled"),id=$(this).data("id"),id==d.rightAnswer?($(this).addClass("green"),setTimeout(function(){1==game.gameMode&&game.nextPlayer(),u()},1500)):($(this).addClass("red"),$(".answer").each(function(){$(this).data("id")==d.rightAnswer&&$(this).addClass("yellow")}),setTimeout(function(){v()},1500)))})},l=function(){$(window).outerHeight()/9>$(window).outerWidth()/16?($("body > #video-background").css({width:"auto",height:"100%"}),$("#video-background-inner").css({width:"auto",height:"150%"})):($("body > #video-background").css({width:"100%",height:"auto"}),$("#video-background-inner").css({width:"150%",height:"auto"})),$(".vertical-center").each(function(){$(this).css("margin-top",$($(this).attr("data-container")).outerHeight()/2-$(this).outerHeight())}),$(".vertical-center-2").each(function(){$(this).css("margin-top",$($(this).attr("data-container")).outerHeight()/2-$(this).outerHeight()/2)})},c=function(){game=new a(s),h.startMenu()},u=function(){difficulty=Math.floor(game.players[game.currentPlayer].questionCount++/3),game.players[game.currentPlayer].questionCount<QUESTIONS_PER_ROUND?h.frage(difficulty):h.endView()},v=function(){0==game.gameMode?h.endView():1==game.gameMode&&(game.expulsedPlayers[game.currentPlayer]=!0,size=function(n){size=0;for(e in n)size++;return size}(game.expulsedPlayers),size==game.players.length?h.endView():(game.nextPlayer(),u()))},h=function(){var e=function(){content='<div class="container-fluid logo-box"><div class="row"><div class="col-md-8 col-centered"><img src="assets/svgs/quzzeldull_logo_text_horizontal.svg" class="img-responsive start-logo" alt="Diamond Scope"></div></div></div><div class="vertical-center container-fluid button-box" data-container="#main-center"><div class="menu-button col-centered rounded-div main-design btn" id="singleplayer-button"><h1>Singleplayer</h1></div><div class="clearfix"></div><div class="menu-button col-centered rounded-div main-design btn" id="multiplayer-button"><h1>Multiplayer</h1></div><div class="clearfix"></div></div>',$("#content-div").html(content),$("#singleplayer-button").on("click",function(){$(this).off("click"),f(n)}),$("#multiplayer-button").on("click",function(){$(this).off("click"),f(t)})},n=function(){content='<div class="container-fluid vertical-center-2" data-container="#main-center"><div class="row" id="player-row"><div class="col-xs-6 col-centered"><div class="main-design"><h1>Spielername</h1></div></div></div><div class="row"><div class="col-xs-6 col-centered"><div class="main-design"><input type="text" class="main-design names" id="player-name"></div></div></div><div class="row" id="button-row"><div class="player-screen-button pull-left"><div class="main-design rounded-div btn" id="back-button"><h1>Zur&uuml;ck</h1></div></div><div class="player-screen-button pull-right"><div class="main-design rounded-div btn" id="next-button"><h1>Weiter</h1></div></div></div></div>',$("#content-div").html(content),$("#back-button").on("click",function(){$(this).off("click"),f(e)}),$("#next-button").on("click",function(){$(this).off("click"),game.addPlayer($("#player-name").val()),game.gameMode=0,f(r),setTimeout(function(){u()},501)})},t=function(){content='<div class="container-fluid vertical-center-2" data-container="#main-center"><div class="row" id="player-row"><div class="col-xs-6 col-centered"><div class="main-design"><h1>Spielernamen</h1></div></div></div><div class="row"><div class="multiplayer-names col-centered relative"><div class="main-design" id="player-names"><input type="text" class="main-design names" id="player-name-1" placeholder="Spieler 1"><input type="text" class="main-design names" id="player-name-2" placeholder="Spieler 2"></div></div>                </div><div class="row" id="button-row"><div class="player-screen-button pull-left"><div class="main-design rounded-div btn" id="back-button"><h1>Zur&uuml;ck</h1></div></div><div class="player-screen-button pull-right"><div class="main-design rounded-div btn" id="next-button"><h1>Weiter</h1></div></div><div class="multiplayer-count btn-group" role="group"><div type="button" id="player-2" data-id="2" class="btn rounded-div main-design count selected"><h1>2</h1></div><div type="button" id="player-3" data-id="3" class="btn rounded-div main-design count"><h1>3</h1></div><div type="button" id="player-4" data-id="4" class="btn rounded-div main-design count"><h1>4</h1></div><div type="button" id="player-5" data-id="5" class="btn rounded-div main-design count"><h1>5</h1></div></div></div></div>',$("#content-div").html(content),$("#back-button").on("click",function(){$(this).off("click"),f(e)}),$(".count").on("click",function(){for($(".count").removeClass("selected"),$(this).addClass("selected"),content="",i=1;i<=$(this).data("id");i++)content+='<input type="text" class="main-design names" id="player-name-'+i+'" placeholder="Spieler '+i+'">';$("#player-names").html(content),l()}),$("#next-button").on("click",function(){$(".names").each(function(){game.addPlayer($(this).val())}),game.gameMode=1,game.questionID++,game.expulsedPlayers={},f(r),setTimeout(function(){u()},501)})},r=function(){content='<div class="container-fluid question-box"><div class="row"><div><div class="col-xs-5 pull-left"><img src="assets/svgs/quzzeldull_logo_text_horizontal.svg" class="img-responsive" alt="Diamond Scope"></div><div class="col-xs-4 pull-right"><div class="main-design" id="current-question"><h3>Frage X</h3></div><div class="main-design" id="player"><h4>Spieler X</h4></div></div></div></div><div class="clearfix"></div><div class="row"><div class="col-xs-12 main-design"><h1 id="question">Wie hei&szlig;t eine gängige Projektmanagement-Methode?</h1></div></div></div><div class="container-fluid answer-box"><div class="container-fluid"><div class="col-md-12 rounded-div main-design answer" data-id="0"><h4 class="pull-left">A</h4><h4 id="answer-a">Duke1</h4></div><div class="col-md-12 rounded-div main-design answer" data-id="1"><h4 class="pull-left">B</h4><h4 id="answer-b">Prince2</h4></div><div class="col-md-12 rounded-div main-design answer" data-id="2"><h4 class="pull-left">C</h4><h4 id="answer-c">King4</h4></div><div class="col-md-12 rounded-div main-design answer" data-id="3"><h4 class="pull-left">D</h4><h4 id="answer-d">Queen3</h4></div></div><div class="row"><div class="col-xs-2 pull-right rounded-div joker-button main-design" id="joker-audience"><h4>Publikum</h4></div><div class="col-xs-2 pull-right rounded-div joker-button main-design" id="joker-fifty"><h4>2 Aus 4</h4></div></div></div>',$("#content-div").html(content)},o=function(){content='<div class="container-fluid question-box"><div class="row"><div><div class="col-xs-5 pull-left"><img src="assets/svgs/quzzeldull_logo_text_horizontal.svg" class="img-responsive" alt="Diamond Scope"></div></div></div></div><div class="vertical-center-2" data-container="#main-center"><div class="row"><div class="col-xs-12 main-design">',content+=game.conclude(),content+='</div></div><div class="menu-button rounded-div main-design btn" id="new-game-button"><h1>Neue Runde</h1></div><div class="menu-button rounded-div main-design btn" id="report-button"><h1>Zur Auswertung</h1></div></div></div>',$("#content-div").html(content),$("#new-game-button").on("click",function(){game.round++<ROUND_LIMIT?(game.questions.forEach(function(e){e.used=!1}),game.expulsedPlayers={},f(r),setTimeout(function(){u()},501)):($(this).html("<h1>Es ist leider nicht möglich mehr als "+ROUND_LIMIT+" Runden zu spielen</h1>"),$(this).off("click"))}),$("#report-button").on("click",function(){c()})},c=function(){content='<div class="container-fluid question-box"><div class="row"><div><div class="col-xs-5 pull-left"><img src="assets/svgs/quzzeldull_logo_text_horizontal.svg" class="img-responsive" alt="Diamond Scope"></div></div></div></div><div class="vertical-center-2" data-container="#main-center"><div class="row"><div class="col-xs-12 main-design">',content+=game.end(),content+='</div></div><div class="menu-button rounded-div main-design btn" id="menu-button"><h1>Zum Hauptmenu</h1></div></div></div>',$("#content-div").html(content),$("#menu-button").on("click",function(){game=new a(s),e()})},v=function(e){function n(e){return selectedQuestions=$.grep(game.questions,function(n){return n.difficulty==e&&0==n.used}),d=selectedQuestions[Math.floor(Math.random()*selectedQuestions.length)],d.used=!0,d}var a,s,r,i=n(e),t=[0,1,2,3],o=i.rightAnswer;for(s=0;4>s;s++)a=Math.floor(Math.random()*(s+1)),a==o&&(i.rightAnswer=s,o=s),r=i.answers[s],i.answers[s]=i.answers[a],i.answers[a]=r,r=t[s],t[s]=t[a],t[a]=r;category=" (Kategorie: "+(e+1)+")",player="Spieler "+(game.players[game.currentPlayer].id+1)+" - "+game.players[game.currentPlayer].name,$("#current-question > h3").html("Frage "+game.players[game.currentPlayer].questionCount+category),$("#player > h4").html(player),$("#question").html(i.question),$("#answer-a").html(i.answers[0]),$("#answer-b").html(i.answers[1]),$("#answer-c").html(i.answers[2]),$("#answer-d").html(i.answers[3]),$(".answer").removeClass("red"),$(".answer").removeClass("green"),$(".answer").removeClass("yellow"),$(".answer").removeClass("disabled"),$(".joker-button").removeClass("disabled"),0==game.players[game.currentPlayer].joker.audience&&$("#joker-audience").addClass("disabled"),0==game.players[game.currentPlayer].joker.fifty&&$("#joker-fifty").addClass("disabled");var l=$("audio").get(0),c=$("audio"),u="assets/voices/voice",v=".mp3";c.attr("src",u+i.id+"-q"+v),l.addEventListener("ended",function(){c.attr("src",u+"-answer-a"+v),l.addEventListener("ended",function(){c.attr("src",u+i.id+"-"+t[0]+v),l.addEventListener("ended",function(){c.attr("src",u+"-answer-b"+v),l.addEventListener("ended",function(){c.attr("src",u+i.id+"-"+t[1]+v),l.addEventListener("ended",function(){c.attr("src",u+"-answer-c"+v),l.addEventListener("ended",function(){c.attr("src",u+i.id+"-"+t[2]+v),l.addEventListener("ended",function(){c.attr("src",u+"-answer-d"+v),l.addEventListener("ended",function(){c.attr("src",u+i.id+"-"+t[3]+v),l.addEventListener("ended",function(){l.pause()}),l.play()}),l.play()}),l.play()}),l.play()}),l.play()}),l.play()}),l.play()}),l.play()}),l.play()},h=function(){f(o)},f=function(e){$("#content-div").addClass("fade"),setTimeout(function(){e(),setTimeout(function(){$("#content-div").removeClass("fade")},500),l()},500)};return{startMenu:e,frage:v,endView:h}}();return{init:r}}();$(function(){$(window).load(function(){setTimeout(function(){$("body > #loading").css("opacity","0"),setTimeout(function(){$("body > #loading").remove()},1001)},1500)}),DiamondScope.init()});